if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a=(e,t)=>{const a=e.__vccOpts||e;for(const[n,o]of t)a[n]=o;return a};const n=a({data:()=>({diningHalls:[],showOrderModal:!1,selectedMerchant:null,selectedDish:null,orderQuantity:1,orderRemark:"",baseUrl:"http://38.55.235.56:3000/api",cartItems:[],showCheckoutConfirm:!1,categoryIndex:1,categories:["早餐","午餐","晚餐"],checkoutForm:{buyerPosition:"",category:"午餐",tips:""}}),computed:{totalQuantity(){return this.cartItems.reduce(((e,t)=>e+t.quantity),0)},totalPrice(){return this.cartItems.reduce(((e,t)=>e+t.price*t.quantity),0)}},mounted(){this.fetchDiningHalls()},methods:{async fetchDiningHalls(){try{const e=(await new Promise(((e,t)=>{uni.request({url:`${this.baseUrl}/dishes/grouped-by-dininghall`,method:"GET",success:t=>{e(t)},fail:e=>{t(e)}})}))).data;if(!e||!e.success)throw new Error((null==e?void 0:e.message)||"获取食堂信息失败");this.diningHalls=e.data.diningHalls}catch(e){t("error","at pages/tabbar/index/index.vue:233","获取食堂信息失败:",e),uni.showToast({title:"获取食堂信息失败",icon:"none"})}},handleOrder(e,t){if(!uni.getStorageSync("userInfo"))return void uni.showToast({title:"请先登录",icon:"none"});const a=this.cartItems.find((e=>e.dishNo===t.dishNo));a?a.quantity<t.quantity?a.quantity++:uni.showToast({title:"库存不足",icon:"none"}):this.cartItems.push({dishNo:t.dishNo,dishName:t.name,price:t.price,quantity:1,merchantNo:e.merchantNo,merchantName:e.name,maxQuantity:t.quantity}),uni.showToast({title:"已加入购物车",icon:"success"})},decreaseCartItem(e){this.cartItems[e].quantity>1?this.cartItems[e].quantity--:this.cartItems.splice(e,1)},increaseCartItem(e){const t=this.cartItems[e];t.quantity<t.maxQuantity?t.quantity++:uni.showToast({title:"库存不足",icon:"none"})},showCheckoutModal(){uni.getStorageSync("userInfo")?this.showCheckoutConfirm=!0:uni.showToast({title:"请先登录",icon:"none"})},closeCheckoutModal(){this.showCheckoutConfirm=!1,this.checkoutForm={buyerPosition:"",category:"午餐",tips:""}},handleCategoryChange(e){this.categoryIndex=e.detail.value,this.checkoutForm.category=this.categories[this.categoryIndex]},async handleCheckout(){if(this.checkoutForm.buyerPosition)try{const e=uni.getStorageSync("userInfo");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});const t="string"==typeof e?JSON.parse(e):e,a=(await new Promise(((e,a)=>{uni.request({url:`${this.baseUrl}/order/batch`,method:"POST",data:{userId:t.userId,items:this.cartItems.map((e=>({dishNo:e.dishNo,quantity:e.quantity,remark:""}))),buyerPosition:this.checkoutForm.buyerPosition,category:this.checkoutForm.category,tips:Number(this.checkoutForm.tips||0)},success:t=>{e(t)},fail:e=>{a(e)}})}))).data;if(!a||!a.success)throw new Error((null==a?void 0:a.message)||"下单失败");uni.showToast({title:"下单成功",icon:"success"}),this.cartItems=[],this.closeCheckoutModal(),this.fetchDiningHalls()}catch(e){t("error","at pages/tabbar/index/index.vue:391","下单失败:",e),uni.showToast({title:e.message||"下单失败，请稍后重试",icon:"none"})}else uni.showToast({title:"请输入配送地址",icon:"none"})},closeOrderModal(){this.showOrderModal=!1,this.selectedMerchant=null,this.selectedDish=null,this.orderQuantity=1,this.orderRemark=""},async submitOrder(){try{const e=uni.getStorageSync("userInfo");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});const t=JSON.parse(e),a=(await new Promise(((e,a)=>{uni.request({url:`${this.baseUrl}/order`,method:"POST",data:{userId:t.userId,merchantNo:this.selectedMerchant.merchantNo,dishNo:this.selectedDish.dishNo,quantity:this.orderQuantity,remark:this.orderRemark},success:t=>{e(t)},fail:e=>{a(e)}})}))).data;if(!a||!a.success)throw new Error((null==a?void 0:a.message)||"下单失败");uni.showToast({title:"下单成功",icon:"success"}),this.closeOrderModal(),this.fetchDiningHalls()}catch(e){t("error","at pages/tabbar/index/index.vue:452","下单失败:",e),uni.showToast({title:e.message||"下单失败，请稍后重试",icon:"none"})}}}},[["render",function(t,a,n,o,s,l){var i,r,c,d,m;return e.openBlock(),e.createElementBlock("view",{class:"index"},[e.createElementVNode("view",{class:"dining-halls"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.diningHalls,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.dininghallNo,class:"dining-hall"},[e.createElementVNode("view",{class:"hall-header"},[e.createElementVNode("text",{class:"hall-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"hall-position"},e.toDisplayString(t.position),1)]),e.createElementVNode("view",{class:"merchants"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.merchants,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.merchantNo,class:"merchant"},[e.createElementVNode("view",{class:"merchant-info"},[e.createElementVNode("text",{class:"merchant-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"merchant-desc"},e.toDisplayString(t.description),1),e.createElementVNode("view",{class:"merchant-rating"},[e.createElementVNode("text",{class:"likes"},"好评: "+e.toDisplayString(t.likes),1),e.createElementVNode("text",{class:"hates"},"差评: "+e.toDisplayString(t.hates),1)])]),e.createElementVNode("view",{class:"dishes"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.dishes,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.dishNo,class:"dish-card"},[e.createElementVNode("view",{class:"dish-info"},[e.createElementVNode("view",{class:"dish-header"},[e.createElementVNode("text",{class:"dish-name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:"dish-price"},"¥"+e.toDisplayString(a.price),1)]),e.createElementVNode("text",{class:"dish-desc"},e.toDisplayString(a.description),1),e.createElementVNode("view",{class:"dish-footer"},[e.createElementVNode("text",{class:"stock"},"库存: "+e.toDisplayString(a.quantity),1),e.createElementVNode("button",{class:"order-btn",disabled:a.quantity<=0,onClick:e=>l.handleOrder(t,a)},e.toDisplayString(a.quantity>0?"点餐":"已售罄"),9,["disabled","onClick"])])])])))),128))])])))),128))])])))),128))]),s.cartItems.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"shopping-cart"},[e.createElementVNode("view",{class:"cart-header"},[e.createElementVNode("view",{class:"cart-info"},[e.createElementVNode("text",{class:"cart-count"},"已选 "+e.toDisplayString(l.totalQuantity)+" 件",1),e.createElementVNode("text",{class:"cart-total"},"合计: ¥"+e.toDisplayString(l.totalPrice.toFixed(2)),1)]),e.createElementVNode("button",{class:"checkout-btn",onClick:a[0]||(a[0]=(...e)=>l.showCheckoutModal&&l.showCheckoutModal(...e))},"去结算")]),e.createElementVNode("scroll-view",{class:"cart-items","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.cartItems,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"cart-item"},[e.createElementVNode("view",{class:"item-info"},[e.createElementVNode("text",{class:"item-name"},e.toDisplayString(t.dishName),1),e.createElementVNode("text",{class:"item-price"},"¥"+e.toDisplayString(t.price),1)]),e.createElementVNode("view",{class:"item-quantity"},[e.createElementVNode("button",{class:"minus",onClick:e=>l.decreaseCartItem(a)},"-",8,["onClick"]),e.createElementVNode("text",{class:"quantity"},e.toDisplayString(t.quantity),1),e.createElementVNode("button",{class:"plus",onClick:e=>l.increaseCartItem(a)},"+",8,["onClick"])])])))),128))])])):e.createCommentVNode("",!0),s.showCheckoutConfirm?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal-mask"},[e.createElementVNode("view",{class:"checkout-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"title"},"确认订单"),e.createElementVNode("text",{class:"close-btn",onClick:a[1]||(a[1]=(...e)=>l.closeCheckoutModal&&l.closeCheckoutModal(...e))},"×")]),e.createElementVNode("view",{class:"checkout-form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"配送地址"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[2]||(a[2]=e=>s.checkoutForm.buyerPosition=e),placeholder:"请输入配送地址（宿舍楼/教学楼/办公楼等）"},null,512),[[e.vModelText,s.checkoutForm.buyerPosition]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"就餐时段"),e.createElementVNode("picker",{class:"picker",value:s.categoryIndex,range:s.categories,onChange:a[3]||(a[3]=(...e)=>l.handleCategoryChange&&l.handleCategoryChange(...e))},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(s.categories[s.categoryIndex]),1)],40,["value","range"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"小费(元)"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>s.checkoutForm.tips=e),placeholder:"请输入小费金额（可选）"},null,512),[[e.vModelText,s.checkoutForm.tips]])]),e.createElementVNode("view",{class:"order-summary"},[e.createElementVNode("view",{class:"summary-item"},[e.createElementVNode("text",{class:"label"},"商品总额"),e.createElementVNode("text",{class:"value"},"¥"+e.toDisplayString(l.totalPrice.toFixed(2)),1)]),e.createElementVNode("view",{class:"summary-item"},[e.createElementVNode("text",{class:"label"},"小费"),e.createElementVNode("text",{class:"value"},"¥"+e.toDisplayString(Number(s.checkoutForm.tips||0).toFixed(2)),1)]),e.createElementVNode("view",{class:"summary-item total"},[e.createElementVNode("text",{class:"label"},"合计"),e.createElementVNode("text",{class:"value"},"¥"+e.toDisplayString((l.totalPrice+Number(s.checkoutForm.tips||0)).toFixed(2)),1)])]),e.createElementVNode("button",{class:"submit-btn",onClick:a[5]||(a[5]=(...e)=>l.handleCheckout&&l.handleCheckout(...e))},"提交订单")])])])):e.createCommentVNode("",!0),s.showOrderModal?(e.openBlock(),e.createElementBlock("view",{key:2,class:"modal-mask"},[e.createElementVNode("view",{class:"order-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"title"},"确认点餐"),e.createElementVNode("text",{class:"close-btn",onClick:a[6]||(a[6]=(...e)=>l.closeOrderModal&&l.closeOrderModal(...e))},"×")]),e.createElementVNode("view",{class:"order-info"},[e.createElementVNode("text",{class:"merchant-name"},e.toDisplayString(null==(i=s.selectedMerchant)?void 0:i.name),1),e.createElementVNode("view",{class:"dish-detail"},[e.createElementVNode("text",{class:"dish-name"},e.toDisplayString(null==(r=s.selectedDish)?void 0:r.name),1),e.createElementVNode("text",{class:"dish-price"},"¥"+e.toDisplayString(null==(c=s.selectedDish)?void 0:c.price),1)]),e.createElementVNode("view",{class:"quantity-control"},[e.createElementVNode("text",{class:"label"},"数量："),e.createElementVNode("view",{class:"control-group"},[e.createElementVNode("button",{class:"minus",disabled:s.orderQuantity<=1,onClick:a[7]||(a[7]=e=>s.orderQuantity>1&&s.orderQuantity--)},"-",8,["disabled"]),e.createElementVNode("text",{class:"quantity"},e.toDisplayString(s.orderQuantity),1),e.createElementVNode("button",{class:"plus",disabled:s.orderQuantity>=(null==(d=s.selectedDish)?void 0:d.quantity),onClick:a[8]||(a[8]=e=>{var t;return s.orderQuantity<(null==(t=s.selectedDish)?void 0:t.quantity)&&s.orderQuantity++})},"+",8,["disabled"])])]),e.createElementVNode("view",{class:"total"},[e.createElementVNode("text",null,"总计："),e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(((null==(m=s.selectedDish)?void 0:m.price)*s.orderQuantity).toFixed(2)),1)]),e.withDirectives(e.createElementVNode("textarea",{class:"remark","onUpdate:modelValue":a[9]||(a[9]=e=>s.orderRemark=e),placeholder:"请输入备注信息（选填）"},null,512),[[e.vModelText,s.orderRemark]]),e.createElementVNode("button",{class:"submit-btn",onClick:a[10]||(a[10]=(...e)=>l.submitOrder&&l.submitOrder(...e))},"提交订单")])])])):e.createCommentVNode("",!0)])}]]);const o=a({data:()=>({orders:[],baseUrl:"http://38.55.235.56:3000/api",userInfo:null}),mounted(){this.fetchOrders(),this.getUserInfo()},onShow(){this.getUserInfo()},methods:{async fetchOrders(){try{const e=(await new Promise(((e,t)=>{uni.request({url:`${this.baseUrl}/order/pending`,method:"GET",success:t=>{e(t)},fail:e=>{t(e)}})}))).data;if(!e||!e.success)throw new Error((null==e?void 0:e.message)||"获取订单列表失败");this.orders=e.data}catch(e){t("error","at pages/tabbar/order/order.vue:100","获取订单列表失败:",e),uni.showToast({title:"获取订单列表失败",icon:"none"})}},formatTime(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},getUserInfo(){try{const e=uni.getStorageSync("userInfo");e&&(this.userInfo="string"==typeof e?JSON.parse(e):e)}catch(e){t("error","at pages/tabbar/order/order.vue:121","获取用户信息失败:",e)}},async handleDeliver(e){try{if(this.userInfo&&this.userInfo.userId){const t=(await new Promise(((t,a)=>{uni.request({url:`${this.baseUrl}/order/update-deliverer`,method:"POST",data:{order_id:e,deliverer_id:this.userInfo.userId},success:e=>{t(e)},fail:e=>{a(e)}})}))).data;if(!t||!t.success)throw new Error((null==t?void 0:t.message)||"接单失败");uni.showToast({title:"接单成功",icon:"success"}),this.fetchOrders()}else uni.showToast({title:"请先登录",icon:"none"})}catch(a){t("error","at pages/tabbar/order/order.vue:163","接单失败:",a),uni.showToast({title:a.message||"接单失败",icon:"none"})}}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"order-page"},[e.createElementVNode("view",{class:"order-list"},[0===s.orders.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",null,"暂无未完成订单")])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(s.orders,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.orderId,class:"order-card"},[e.createElementVNode("view",{class:"order-header"},[e.createElementVNode("text",{class:"order-id"},"订单号："+e.toDisplayString(t.orderId),1),e.createElementVNode("text",{class:"order-time"},e.toDisplayString(l.formatTime(t.orderTime)),1)]),e.createElementVNode("view",{class:"order-content"},[e.createElementVNode("view",{class:"delivery-info"},[e.createElementVNode("text",{class:"label"},"配送地址："),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.buyerPosition),1)]),e.createElementVNode("view",{class:"category-info"},[e.createElementVNode("text",{class:"label"},"就餐时段："),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.category),1)]),e.createElementVNode("view",{class:"items-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"item"},[e.createElementVNode("view",{class:"item-main"},[e.createElementVNode("text",{class:"dish-name"},e.toDisplayString(t.dishName),1),e.createElementVNode("text",{class:"quantity"},"x"+e.toDisplayString(t.quantity),1)]),e.createElementVNode("view",{class:"item-sub"},[e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(t.price),1),t.note?(e.openBlock(),e.createElementBlock("text",{key:0,class:"note"},"备注："+e.toDisplayString(t.note),1)):e.createCommentVNode("",!0)])])))),128))])]),e.createElementVNode("view",{class:"order-footer"},[e.createElementVNode("view",{class:"status-group"},[e.createElementVNode("text",{class:e.normalizeClass(["payment-status",t.paymentStatus])},e.toDisplayString(t.paymentStatus),3),t.deliveryStatus?(e.openBlock(),e.createElementBlock("text",{key:0,class:e.normalizeClass(["delivery-status",t.deliveryStatus])},e.toDisplayString(t.deliveryStatus),3)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"action-group"},[t.tips>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"tips"},"小费：¥"+e.toDisplayString(t.tips),1)):e.createCommentVNode("",!0),"已支付"!==t.paymentStatus||t.deliveryStatus?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:1,class:"deliver-btn",onClick:e=>l.handleDeliver(t.orderId)},"我来配送",8,["onClick"]))])])])))),128))])])}]]);const s=a({components:{PersonalCenter:a({name:"PersonalCenter",data:()=>({isLoggedIn:!1,showLoginForm:!1,userType:"",activeTab:"login",loginType:"user",userInfo:null,merchantInfo:null,diningHalls:[{no:1,name:"荔园美食汇"},{no:2,name:"听山餐厅"},{no:3,name:"荔天餐厅"},{no:4,name:"伐木餐厅"}],loginForm:{userId:"",merchantNo:"",password:""},registerForm:{userId:"",name:"",college:"",contact:"",grade:"",password:"",merchantNo:"",description:"",phone:"",dininghallNo:""}}),methods:{showLoginModal(){this.showLoginForm=!0},closeLoginPopup(){this.showLoginForm=!1,this.resetForms()},resetForms(){this.loginForm={userId:"",merchantNo:"",password:""},this.registerForm={userId:"",name:"",college:"",contact:"",grade:"",password:"",merchantNo:"",description:"",phone:"",dininghallNo:""}},async handleLogin(){try{const e="user"===this.loginType?"http://38.55.235.56:3000/api/user/login":"http://38.55.235.56:3000/api/merchant/login",t="user"===this.loginType?{userId:this.loginForm.userId,password:this.loginForm.password}:{merchantNo:this.loginForm.merchantNo,password:this.loginForm.password},a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await a.json();if(n.success){if(this.isLoggedIn=!0,this.userType=this.loginType,"user"===this.loginType){this.userInfo=n.data.user;const e={userId:n.data.user.userId,name:n.data.user.name,college:n.data.user.college,contact:n.data.user.contact,grade:n.data.user.grade,type:n.data.user.type};uni.setStorageSync("userInfo",e),uni.setStorageSync("userType","user"),uni.setStorageSync("isLoggedIn","true")}else this.merchantInfo=n.data.merchant,uni.setStorageSync("merchantInfo",n.data.merchant),uni.setStorageSync("userType","merchant"),uni.setStorageSync("isLoggedIn","true");this.closeLoginPopup(),uni.showToast({title:"登录成功",icon:"success"})}else uni.showToast({title:n.message||"登录失败",icon:"none"})}catch(e){t("error","at components/personal-center/PersonalCenter.vue:306","登录错误:",e);let a="网络错误...";"TypeError"===e.name&&e.message.includes("Failed to fetch")?a="无法连接到服务器，请检查网络连接":e instanceof SyntaxError&&(a="服务器响应格式错误"),uni.showToast({title:a,icon:"none",duration:2e3})}},async handleRegister(){try{const e="user"===this.loginType?"http://38.55.235.56:3000/api/user/register":"http://38.55.235.56:3000/api/merchant/register",t="user"===this.loginType?{userId:this.registerForm.userId,name:this.registerForm.name,college:this.registerForm.college,contact:this.registerForm.contact,grade:this.registerForm.grade,password:this.registerForm.password}:{merchantNo:this.registerForm.merchantNo,name:this.registerForm.name,description:this.registerForm.description,phone:this.registerForm.phone,dininghallNo:this.registerForm.dininghallNo,password:this.registerForm.password},a=await uni.request({url:e,method:"POST",data:t});a.data.success?(uni.showToast({title:"注册成功",icon:"success"}),this.activeTab="login"):uni.showToast({title:a.data.message||"注册失败",icon:"none"})}catch(e){uni.showToast({title:"网络错误",icon:"none"})}},handleDeliveries(){this.userInfo&&this.userInfo.userId?uni.navigateTo({url:`/pages/user/deliveries/deliveries?userId=${this.userInfo.userId}`}):uni.showToast({title:"请先登录",icon:"none"})},handleComplaints(){this.userInfo?1===this.userInfo.type?uni.navigateTo({url:"/pages/admin/complaints/complaints"}):uni.navigateTo({url:`/pages/user/complaints/complaints?userId=${this.userInfo.userId}`}):uni.showToast({title:"请先登录",icon:"none"})},handleSettings(){this.userInfo?uni.navigateTo({url:"/pages/user/settings/settings"}):uni.showToast({title:"请先登录",icon:"none"})},handleDishes(){uni.navigateTo({url:"/pages/merchant/dishes/dishes"})},handleMerchantOrders(){uni.navigateTo({url:"/pages/merchant/orders/orders"})},handleShopSettings(){uni.navigateTo({url:"/pages/merchant/settings/settings"})},handleLogout(){uni.removeStorageSync("isLoggedIn"),uni.removeStorageSync("userType"),uni.removeStorageSync("userInfo"),uni.removeStorageSync("merchantInfo"),this.isLoggedIn=!1,this.userType="",this.userInfo=null,this.merchantInfo=null,uni.showToast({title:"已退出登录",icon:"success"})},handleMerchantAudit(){uni.navigateTo({url:"/pages/admin/merchant-audit/merchant-audit"})},handleBlacklist(){uni.navigateTo({url:"/pages/admin/blacklist/blacklist"})},handleOrders(){this.userInfo&&this.userInfo.userId?uni.navigateTo({url:`/pages/user/orders/orders?userId=${this.userInfo.userId}`}):uni.showToast({title:"请先登录",icon:"none"})}},mounted(){const e="true"===uni.getStorageSync("isLoggedIn"),t=uni.getStorageSync("userType");if(e&&t)if(this.isLoggedIn=!0,this.userType=t,"user"===t){const e=uni.getStorageSync("userInfo");e&&(this.userInfo={...e,userId:e.user_id||e.userId},uni.setStorageSync("userInfo",this.userInfo))}else if("merchant"===t){const e=uni.getStorageSync("merchantInfo");e&&(this.merchantInfo=e)}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"personal-center"},[s.isLoggedIn?s.userInfo&&"user"===s.userType?(e.openBlock(),e.createElementBlock("view",{key:1,class:"user-info"},[e.createElementVNode("view",{class:"info-header"},[e.createElementVNode("image",{class:"avatar",src:"/static/default-avatar.png"}),e.createElementVNode("view",{class:"basic-info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(s.userInfo.name),1),e.createElementVNode("text",{class:"college"},e.toDisplayString(s.userInfo.college)+" | "+e.toDisplayString(s.userInfo.grade)+"年级",1),1===s.userInfo.type?(e.openBlock(),e.createElementBlock("text",{key:0,class:"admin-badge"},"管理员")):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"info-list"},[e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"联系方式："),e.createElementVNode("text",null,e.toDisplayString(s.userInfo.contact),1)]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"menu-list"},[1===s.userInfo.type?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"menu-item",onClick:a[1]||(a[1]=(...e)=>l.handleComplaints&&l.handleComplaints(...e))},[e.createElementVNode("text",{class:"iconfont icon-complaint"}),e.createElementVNode("text",null,"管理投诉")]),e.createElementVNode("view",{class:"menu-item",onClick:a[2]||(a[2]=(...e)=>l.handleMerchantAudit&&l.handleMerchantAudit(...e))},[e.createElementVNode("text",{class:"iconfont icon-audit"}),e.createElementVNode("text",null,"审核商家")]),e.createElementVNode("view",{class:"menu-item",onClick:a[3]||(a[3]=(...e)=>l.handleBlacklist&&l.handleBlacklist(...e))},[e.createElementVNode("text",{class:"iconfont icon-blacklist"}),e.createElementVNode("text",null,"管理黑名单")])],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("view",{class:"menu-item",onClick:a[4]||(a[4]=(...e)=>l.handleOrders&&l.handleOrders(...e))},[e.createElementVNode("text",{class:"iconfont icon-order"}),e.createElementVNode("text",null,"我的订单")]),e.createElementVNode("view",{class:"menu-item",onClick:a[5]||(a[5]=(...e)=>l.handleDeliveries&&l.handleDeliveries(...e))},[e.createElementVNode("text",{class:"iconfont icon-delivery"}),e.createElementVNode("text",null,"配送记录")]),e.createElementVNode("view",{class:"menu-item",onClick:a[6]||(a[6]=(...e)=>l.handleComplaints&&l.handleComplaints(...e))},[e.createElementVNode("text",{class:"iconfont icon-complaint"}),e.createElementVNode("text",null,"投诉记录")]),e.createElementVNode("view",{class:"menu-item",onClick:a[7]||(a[7]=(...e)=>l.handleSettings&&l.handleSettings(...e))},[e.createElementVNode("text",{class:"iconfont icon-settings"}),e.createElementVNode("text",null,"个人设置")])],64)),e.createElementVNode("view",{class:"menu-item logout",onClick:a[8]||(a[8]=(...e)=>l.handleLogout&&l.handleLogout(...e))},[e.createElementVNode("text",{class:"iconfont icon-logout"}),e.createElementVNode("text",null,"退出登录")])])])])):s.merchantInfo&&"merchant"===s.userType?(e.openBlock(),e.createElementBlock("view",{key:2,class:"merchant-info"},[e.createElementVNode("view",{class:"info-header"},[e.createElementVNode("image",{class:"shop-logo",src:"/static/default-shop.png"}),e.createElementVNode("view",{class:"basic-info"},[e.createElementVNode("text",{class:"shop-name"},e.toDisplayString(s.merchantInfo.name),1),e.createElementVNode("text",{class:e.normalizeClass(["status",s.merchantInfo.status])},e.toDisplayString(s.merchantInfo.status),3)])]),e.createElementVNode("view",{class:"info-list"},[e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"商家描述："),e.createElementVNode("text",null,e.toDisplayString(s.merchantInfo.description),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"label"},"联系电话："),e.createElementVNode("text",null,e.toDisplayString(s.merchantInfo.phone),1)]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"menu-list"},[e.createElementVNode("view",{class:"menu-item",onClick:a[9]||(a[9]=(...e)=>l.handleDishes&&l.handleDishes(...e))},[e.createElementVNode("text",{class:"iconfont icon-dish"}),e.createElementVNode("text",null,"菜品管理")]),e.createElementVNode("view",{class:"menu-item",onClick:a[10]||(a[10]=(...e)=>l.handleShopSettings&&l.handleShopSettings(...e))},[e.createElementVNode("text",{class:"iconfont icon-settings"}),e.createElementVNode("text",null,"店铺设置")]),e.createElementVNode("view",{class:"menu-item logout",onClick:a[11]||(a[11]=(...e)=>l.handleLogout&&l.handleLogout(...e))},[e.createElementVNode("text",{class:"iconfont icon-logout"}),e.createElementVNode("text",null,"退出登录")])])])])):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"login-section"},[e.createElementVNode("view",{class:"welcome-text"},"欢迎使用校园代买餐平台"),e.createElementVNode("button",{class:"login-btn",onClick:a[0]||(a[0]=(...e)=>l.showLoginModal&&l.showLoginModal(...e))},"登录/注册")])),s.showLoginForm?(e.openBlock(),e.createElementBlock("view",{key:3,class:"modal-mask"},[e.createElementVNode("view",{class:"login-popup"},[e.createElementVNode("view",{class:"tab-header"},[e.createElementVNode("text",{class:e.normalizeClass(["tab-item","login"===s.activeTab?"active":""]),onClick:a[12]||(a[12]=e=>s.activeTab="login")},"登录",2),e.createElementVNode("text",{class:e.normalizeClass(["tab-item","register"===s.activeTab?"active":""]),onClick:a[13]||(a[13]=e=>s.activeTab="register")},"注册",2)]),e.createElementVNode("view",{class:"role-switch"},[e.createElementVNode("text",{class:e.normalizeClass(["role-item","user"===s.loginType?"active":""]),onClick:a[14]||(a[14]=e=>s.loginType="user")},"个人用户",2),e.createElementVNode("text",{class:e.normalizeClass(["role-item","merchant"===s.loginType?"active":""]),onClick:a[15]||(a[15]=e=>s.loginType="merchant")},"商家",2)]),"login"===s.activeTab?(e.openBlock(),e.createElementBlock("view",{key:0,class:"form"},["user"===s.loginType?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"number","onUpdate:modelValue":a[16]||(a[16]=e=>s.loginForm.userId=e),placeholder:"请输入学号"},null,512)),[[e.vModelText,s.loginForm.userId]]):e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:1,type:"number","onUpdate:modelValue":a[17]||(a[17]=e=>s.loginForm.merchantNo=e),placeholder:"请输入商家编号"},null,512)),[[e.vModelText,s.loginForm.merchantNo]]),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[18]||(a[18]=e=>s.loginForm.password=e),placeholder:"请输入密码"},null,512),[[e.vModelText,s.loginForm.password]]),e.createElementVNode("button",{class:"submit-btn",onClick:a[19]||(a[19]=(...e)=>l.handleLogin&&l.handleLogin(...e))},"登录")])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"form"},["user"===s.loginType?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":a[20]||(a[20]=e=>s.registerForm.userId=e),placeholder:"请输入学号"},null,512),[[e.vModelText,s.registerForm.userId]]),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[21]||(a[21]=e=>s.registerForm.name=e),placeholder:"请输入姓名"},null,512),[[e.vModelText,s.registerForm.name]]),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[22]||(a[22]=e=>s.registerForm.college=e),placeholder:"请输入学院"},null,512),[[e.vModelText,s.registerForm.college]]),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[23]||(a[23]=e=>s.registerForm.contact=e),placeholder:"请输入联系方式"},null,512),[[e.vModelText,s.registerForm.contact]]),e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":a[24]||(a[24]=e=>s.registerForm.grade=e),placeholder:"请输入年级"},null,512),[[e.vModelText,s.registerForm.grade]]),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[25]||(a[25]=e=>s.registerForm.password=e),placeholder:"请输入密码"},null,512),[[e.vModelText,s.registerForm.password]])],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.withDirectives(e.createElementVNode("input",{type:"number","onUpdate:modelValue":a[26]||(a[26]=e=>s.registerForm.merchantNo=e),placeholder:"请输入商家编号"},null,512),[[e.vModelText,s.registerForm.merchantNo]]),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[27]||(a[27]=e=>s.registerForm.name=e),placeholder:"请输入商家名称"},null,512),[[e.vModelText,s.registerForm.name]]),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[28]||(a[28]=e=>s.registerForm.description=e),placeholder:"请输入商家描述"},null,512),[[e.vModelText,s.registerForm.description]]),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[29]||(a[29]=e=>s.registerForm.phone=e),placeholder:"请输入联系电话"},null,512),[[e.vModelText,s.registerForm.phone]]),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":a[30]||(a[30]=e=>s.registerForm.dininghallNo=e)},[e.createElementVNode("option",{value:""},"请选择所属食堂"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.diningHalls,(t=>(e.openBlock(),e.createElementBlock("option",{key:t.no,value:t.no},e.toDisplayString(t.name),9,["value"])))),128))],512),[[e.vModelSelect,s.registerForm.dininghallNo]]),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[31]||(a[31]=e=>s.registerForm.password=e),placeholder:"请输入密码"},null,512),[[e.vModelText,s.registerForm.password]])],64)),e.createElementVNode("button",{class:"submit-btn",onClick:a[32]||(a[32]=(...e)=>l.handleRegister&&l.handleRegister(...e))},"注册")])),e.createElementVNode("text",{class:"close-btn",onClick:a[33]||(a[33]=(...e)=>l.closeLoginPopup&&l.closeLoginPopup(...e))},"×")])])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-b4de894c"]])},data:()=>({}),methods:{}},[["render",function(t,a,n,o,s,l){const i=e.resolveComponent("personal-center");return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(i)])}]]);const l=a({data:()=>({loading:!0,merchants:[],diningHalls:[{no:1,name:"荔园美食汇"},{no:2,name:"听山餐厅"},{no:3,name:"荔天餐厅"},{no:4,name:"伐木餐厅"}]}),mounted(){this.fetchPendingMerchants()},methods:{async fetchPendingMerchants(){try{const e=await fetch("http://38.55.235.56:3000/api/merchant/pending"),t=await e.json();t.success?this.merchants=t.data.merchants:uni.showToast({title:t.message||"获取商家列表失败",icon:"none"})}catch(e){t("error","at pages/admin/merchant-audit/merchant-audit.vue:72","获取待审核商家失败:",e),uni.showToast({title:"网络错误",icon:"none"})}finally{this.loading=!1}},getDiningHallName(e){const t=this.diningHalls.find((t=>t.no===e));return t?t.name:"未知食堂"},async handleApprove(e){try{const t=await fetch(`http://38.55.235.56:3000/api/merchant/audit/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"已通过"})}),a=await t.json();a.success?(uni.showToast({title:"审核通过",icon:"success"}),this.fetchPendingMerchants()):uni.showToast({title:a.message||"操作失败",icon:"none"})}catch(a){t("error","at pages/admin/merchant-audit/merchant-audit.vue:114","审核操作失败:",a),uni.showToast({title:"网络错误",icon:"none"})}},async handleReject(e){try{const t=await fetch(`http://38.55.235.56:3000/api/merchant/audit/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"已拒绝"})}),a=await t.json();a.success?(uni.showToast({title:"已拒绝商家申请",icon:"success"}),this.fetchPendingMerchants()):uni.showToast({title:a.message||"操作失败",icon:"none"})}catch(a){t("error","at pages/admin/merchant-audit/merchant-audit.vue:149","审核操作失败:",a),uni.showToast({title:"网络错误",icon:"none"})}}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"merchant-audit"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"商家审核")]),s.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},[e.createElementVNode("view",{class:"loading-spinner"}),e.createElementVNode("text",null,"加载中...")])):0===s.merchants.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},[e.createElementVNode("text",null,"暂无待审核的商家")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"merchant-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.merchants,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.merchantNo,class:"merchant-card"},[e.createElementVNode("view",{class:"merchant-info"},[e.createElementVNode("view",{class:"main-info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"merchant-no"},"商家编号: "+e.toDisplayString(t.merchantNo),1)]),e.createElementVNode("view",{class:"details"},[e.createElementVNode("text",{class:"description"},e.toDisplayString(t.description),1),e.createElementVNode("text",{class:"phone"},"联系电话: "+e.toDisplayString(t.phone),1),e.createElementVNode("text",{class:"location"},"所属食堂: "+e.toDisplayString(l.getDiningHallName(t.dininghallNo)),1)])]),e.createElementVNode("view",{class:"audit-actions"},[e.createElementVNode("button",{class:"approve-btn",onClick:e=>l.handleApprove(t.merchantNo)},"通过",8,["onClick"]),e.createElementVNode("button",{class:"reject-btn",onClick:e=>l.handleReject(t.merchantNo)},"拒绝",8,["onClick"])])])))),128))]))])}]]);const i=a({data:()=>({complaints:[],loading:!0,baseUrl:"http://38.55.235.56:3000/api",userInfo:null}),onLoad(){this.loadComplaints();const e=uni.getStorageSync("userInfo");e&&(this.userInfo="object"==typeof e?e:JSON.parse(e))},onPullDownRefresh(){this.loadComplaints()},methods:{async loadComplaints(){this.loading=!0;try{const e=await new Promise(((e,t)=>{uni.request({url:`${this.baseUrl}/order/pending-complaints`,method:"GET",success:t=>e(t),fail:e=>t(e)})}));e.data.success?this.complaints=e.data.data:uni.showToast({title:e.data.message||"获取投诉记录失败",icon:"none"})}catch(e){uni.showToast({title:"获取投诉记录失败",icon:"none"})}finally{this.loading=!1,uni.stopPullDownRefresh()}},async handleComplaint(e,t){try{const a=await new Promise(((a,n)=>{uni.request({url:`${this.baseUrl}/order/complaint/${e}/handle`,method:"POST",data:{status:t},success:e=>a(e),fail:e=>n(e)})}));a.data.success?(uni.showToast({title:"处理成功",icon:"success"}),this.loadComplaints()):uni.showToast({title:a.data.message||"处理失败",icon:"none"})}catch(a){uni.showToast({title:"处理失败",icon:"none"})}},async handleAddToBlacklist(e,t){if(this.userInfo)try{const a=await new Promise(((a,n)=>{uni.request({url:`${this.baseUrl}/blacklist/add`,method:"POST",data:{user_id:e,reason:t,created_by:this.userInfo.userId},success:e=>a(e),fail:e=>n(e)})}));a.data.success?uni.showToast({title:"已加入黑名单",icon:"success"}):uni.showToast({title:a.data.message||"加入黑名单失败",icon:"none"})}catch(a){uni.showToast({title:"加入黑名单失败",icon:"none"})}else uni.showToast({title:"管理员信息获取失败",icon:"none"})},formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"complaints-container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"投诉管理")]),s.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},[e.createElementVNode("text",null,"加载中...")])):0===s.complaints.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("text",null,"暂无未处理的投诉")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"complaints-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.complaints,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.complaintId,class:"complaint-card"},[e.createElementVNode("view",{class:"complaint-header"},[e.createElementVNode("text",{class:"order-time"},"订单时间："+e.toDisplayString(l.formatDate(t.orderTime)),1),e.createElementVNode("text",{class:"status status-pending"},e.toDisplayString(t.status),1)]),e.createElementVNode("view",{class:"complaint-content"},[e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"订单编号："),e.createElementVNode("text",null,e.toDisplayString(t.orderId),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"投诉人："),e.createElementVNode("text",null,e.toDisplayString(t.complainantName)+" (ID: "+e.toDisplayString(t.complainantId)+")",1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"联系方式："),e.createElementVNode("text",null,e.toDisplayString(t.complainantContact),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"下单者："),e.createElementVNode("text",null,e.toDisplayString(t.buyerName)+" (ID: "+e.toDisplayString(t.buyerId)+")",1),e.createElementVNode("button",{class:"blacklist-btn",onClick:e=>l.handleAddToBlacklist(t.buyerId,"下单者违规")},"加入黑名单",8,["onClick"])]),t.delivererId?(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-row"},[e.createElementVNode("text",{class:"label"},"配送者："),e.createElementVNode("text",null,e.toDisplayString(t.delivererName)+" (ID: "+e.toDisplayString(t.delivererId)+")",1),e.createElementVNode("button",{class:"blacklist-btn",onClick:e=>l.handleAddToBlacklist(t.delivererId,"配送者违规")},"加入黑名单",8,["onClick"])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"订单类型："),e.createElementVNode("text",null,e.toDisplayString(t.category),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"配送地址："),e.createElementVNode("text",null,e.toDisplayString(t.buyerPosition),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"投诉类型："),e.createElementVNode("text",null,e.toDisplayString(t.complaintType),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"投诉原因："),e.createElementVNode("text",null,e.toDisplayString(t.reason),1)]),t.evidence?(e.openBlock(),e.createElementBlock("view",{key:1,class:"info-row"},[e.createElementVNode("text",{class:"label"},"证据说明："),e.createElementVNode("text",null,e.toDisplayString(t.evidence),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"投诉时间："),e.createElementVNode("text",null,e.toDisplayString(l.formatDate(t.createdAt)),1)])]),e.createElementVNode("view",{class:"complaint-actions"},[e.createElementVNode("button",{class:"action-btn approve",onClick:e=>l.handleComplaint(t.complaintId,"已处理")},"处理",8,["onClick"]),e.createElementVNode("button",{class:"action-btn reject",onClick:e=>l.handleComplaint(t.complaintId,"已驳回")},"驳回",8,["onClick"])])])))),128))]))])}]]);const r=a({data:()=>({blacklist:[],loading:!0,baseUrl:"http://38.55.235.56:3000/api"}),onLoad(){this.loadBlacklist()},onPullDownRefresh(){this.loadBlacklist()},methods:{async loadBlacklist(){this.loading=!0;try{const e=await new Promise(((e,t)=>{uni.request({url:`${this.baseUrl}/blacklist/active`,method:"GET",success:t=>e(t),fail:e=>t(e)})}));e.data.success?this.blacklist=e.data.data:uni.showToast({title:e.data.message||"获取黑名单记录失败",icon:"none"})}catch(e){uni.showToast({title:"获取黑名单记录失败",icon:"none"})}finally{this.loading=!1,uni.stopPullDownRefresh()}},async handleRemove(e){try{const t=await new Promise(((t,a)=>{uni.request({url:`${this.baseUrl}/blacklist/${e}/remove`,method:"POST",success:e=>t(e),fail:e=>a(e)})}));t.data.success?(uni.showToast({title:"解除成功",icon:"success"}),this.loadBlacklist()):uni.showToast({title:t.data.message||"解除失败",icon:"none"})}catch(t){uni.showToast({title:"解除失败",icon:"none"})}},formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"blacklist-container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"黑名单管理")]),s.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},[e.createElementVNode("text",null,"加载中...")])):0===s.blacklist.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("text",null,"暂无黑名单记录")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"blacklist-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.blacklist,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.blacklist_id,class:"blacklist-card"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"用户ID："),e.createElementVNode("text",null,e.toDisplayString(t.user.user_id),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"姓名："),e.createElementVNode("text",null,e.toDisplayString(t.user.name),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"学院："),e.createElementVNode("text",null,e.toDisplayString(t.user.college),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"年级："),e.createElementVNode("text",null,e.toDisplayString(t.user.grade),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"联系方式："),e.createElementVNode("text",null,e.toDisplayString(t.user.contact),1)])]),e.createElementVNode("view",{class:"blacklist-info"},[e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"加入原因："),e.createElementVNode("text",null,e.toDisplayString(t.reason),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"操作管理员："),e.createElementVNode("text",null,e.toDisplayString(t.created_by.name),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"加入时间："),e.createElementVNode("text",null,e.toDisplayString(l.formatDate(t.created_at)),1)])]),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("button",{class:"remove-btn",onClick:e=>l.handleRemove(t.blacklist_id)},"解除黑名单",8,["onClick"])])])))),128))]))])}]]);const c=a({data:()=>({orders:[],baseUrl:"http://38.55.235.56:3000/api",userId:""}),onLoad(e){e.userId&&(this.userId=e.userId,this.fetchOrders())},methods:{async fetchOrders(){try{const e=(await new Promise(((e,t)=>{uni.request({url:`${this.baseUrl}/order/delivery/${this.userId}`,method:"GET",success:t=>{e(t)},fail:e=>{t(e)}})}))).data;if(!e||!e.success)throw new Error((null==e?void 0:e.message)||"获取配送记录失败");this.orders=e.data}catch(e){t("error","at pages/user/deliveries/deliveries.vue:98","获取配送记录失败:",e),uni.showToast({title:"获取配送记录失败",icon:"none"})}},formatTime(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},async handleCompleteDelivery(e){try{const t=(await new Promise(((t,a)=>{uni.request({url:`${this.baseUrl}/order/complete-delivery`,method:"POST",data:{order_id:e},success:e=>{t(e)},fail:e=>{a(e)}})}))).data;if(!t||!t.success)throw new Error((null==t?void 0:t.message)||"完成配送失败");uni.showToast({title:"配送完成",icon:"success"}),this.fetchOrders()}catch(a){t("error","at pages/user/deliveries/deliveries.vue:141","完成配送失败:",a),uni.showToast({title:a.message||"完成配送失败",icon:"none"})}}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"deliveries-page"},[e.createElementVNode("view",{class:"order-list"},[0===s.orders.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",null,"暂无配送记录")])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(s.orders,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.orderId,class:"order-card"},[e.createElementVNode("view",{class:"order-header"},[e.createElementVNode("text",{class:"order-id"},"订单号："+e.toDisplayString(t.orderId),1),e.createElementVNode("text",{class:"order-time"},e.toDisplayString(l.formatTime(t.orderTime)),1)]),e.createElementVNode("view",{class:"order-content"},[e.createElementVNode("view",{class:"delivery-info"},[e.createElementVNode("text",{class:"label"},"配送地址："),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.buyerPosition),1)]),e.createElementVNode("view",{class:"category-info"},[e.createElementVNode("text",{class:"label"},"就餐时段："),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.category),1)]),e.createElementVNode("view",{class:"items-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"item"},[e.createElementVNode("view",{class:"item-main"},[e.createElementVNode("text",{class:"dish-name"},e.toDisplayString(t.dishName),1),e.createElementVNode("text",{class:"quantity"},"x"+e.toDisplayString(t.quantity),1)]),e.createElementVNode("view",{class:"item-sub"},[e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(t.price),1),t.note?(e.openBlock(),e.createElementBlock("text",{key:0,class:"note"},"备注："+e.toDisplayString(t.note),1)):e.createCommentVNode("",!0)])])))),128))])]),e.createElementVNode("view",{class:"order-footer"},[e.createElementVNode("view",{class:"status-group"},[e.createElementVNode("text",{class:e.normalizeClass(["payment-status",t.paymentStatus])},e.toDisplayString(t.paymentStatus),3),e.createElementVNode("text",{class:e.normalizeClass(["delivery-status",t.deliveryStatus])},e.toDisplayString(t.deliveryStatus),3)]),e.createElementVNode("view",{class:"action-group"},[t.tips>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"tips"},"小费：¥"+e.toDisplayString(t.tips),1)):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"total-amount"},"总计：¥"+e.toDisplayString(t.totalAmount),1),"配送中"===t.deliveryStatus?(e.openBlock(),e.createElementBlock("button",{key:1,class:"complete-btn",onClick:e=>l.handleCompleteDelivery(t.orderId)},"完成配送",8,["onClick"])):e.createCommentVNode("",!0)])])])))),128))])])}]]);const d=a({data:()=>({loading:!0,dishes:[],showAddModal:!1,showEditModal:!1,baseUrl:"http://38.55.235.56:3000/api",newDish:{name:"",price:"",stock:"",description:""},editingDish:{id:"",name:"",price:"",stock:"",description:""}}),mounted(){this.fetchDishes()},methods:{async fetchDishes(){try{const e=uni.getStorageSync("merchantInfo");if(!e)return uni.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{uni.switchTab({url:"/pages/tabbar/mine/mine"})}),1500);if(!e.merchantNo)return void uni.showToast({title:"商家信息不完整",icon:"none"});const t=(await new Promise(((t,a)=>{uni.request({url:`${this.baseUrl}/dishes/merchant/${e.merchantNo}`,method:"GET",success:e=>{t(e)},fail:e=>{a(e)}})}))).data;if(!t||!t.success)throw new Error((null==t?void 0:t.message)||"获取菜品列表失败");{const e=t.data.merchant;this.dishes=e.dishes.map((e=>({id:e.dishNo,name:e.dishname||e.name,price:e.price,stock:e.quantity,description:e.description})))}}catch(e){t("error","at pages/merchant/dishes/dishes.vue:153","获取菜品列表失败:",e),uni.showToast({title:"服务器连接失败，请检查网络",icon:"none"})}finally{this.loading=!1}},showAddDishModal(){this.showAddModal=!0},hideAddDishModal(){this.showAddModal=!1,this.newDish={name:"",price:"",stock:"",description:""}},async addDish(){if(this.newDish.name&&this.newDish.price&&this.newDish.stock)try{const e=uni.getStorageSync("merchantInfo");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});if(!e.merchantNo)return void uni.showToast({title:"商家信息不完整",icon:"none"});const t=(await new Promise(((t,a)=>{uni.request({url:`${this.baseUrl}/dishes`,method:"POST",header:{"Content-Type":"application/json"},data:{name:this.newDish.name,price:parseFloat(this.newDish.price),stock:parseInt(this.newDish.stock),description:this.newDish.description,merchantNo:e.merchantNo},success:e=>{t(e)},fail:e=>{a(e)}})}))).data;if(!t||!t.success)throw new Error((null==t?void 0:t.message)||"添加失败");uni.showToast({title:"添加成功",icon:"success"}),this.hideAddDishModal(),this.fetchDishes()}catch(e){t("error","at pages/merchant/dishes/dishes.vue:239","添加菜品失败:",e),uni.showToast({title:"服务器连接失败，请检查网络",icon:"none"})}else uni.showToast({title:"请填写完整信息",icon:"none"})},showEditDishModal(e){this.editingDish={id:e.id,name:e.name,price:e.price.toString(),stock:e.stock.toString(),description:e.description},this.showEditModal=!0},hideEditDishModal(){this.showEditModal=!1,this.editingDish={id:"",name:"",price:"",stock:"",description:""}},async updateDish(){if(this.editingDish.name&&this.editingDish.price&&this.editingDish.stock)try{const e=uni.getStorageSync("merchantInfo");if(!e)return void uni.showToast({title:"请先登录",icon:"none"});if(!e.merchantNo)return void uni.showToast({title:"商家信息不完整",icon:"none"});const t=(await new Promise(((t,a)=>{uni.request({url:`${this.baseUrl}/dishes/${this.editingDish.id}`,method:"PUT",header:{"Content-Type":"application/json"},data:{name:this.editingDish.name,price:parseFloat(this.editingDish.price),stock:parseInt(this.editingDish.stock),description:this.editingDish.description,merchantNo:e.merchantNo},success:e=>{t(e)},fail:e=>{a(e)}})}))).data;if(!t||!t.success)throw new Error((null==t?void 0:t.message)||"修改失败");uni.showToast({title:"修改成功",icon:"success"}),this.hideEditDishModal(),this.fetchDishes()}catch(e){t("error","at pages/merchant/dishes/dishes.vue:331","修改菜品失败:",e),uni.showToast({title:"服务器连接失败，请检查网络",icon:"none"})}else uni.showToast({title:"请填写完整信息",icon:"none"})}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"dishes"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"菜品管理"),e.createElementVNode("button",{class:"add-btn",onClick:a[0]||(a[0]=(...e)=>l.showAddDishModal&&l.showAddDishModal(...e))},[e.createElementVNode("text",{class:"iconfont icon-add"}),e.createElementVNode("text",null,"新增菜品")])]),s.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},[e.createElementVNode("view",{class:"loading-spinner"}),e.createElementVNode("text",null,"加载中...")])):0===s.dishes.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},[e.createElementVNode("text",null,"当前无已发布菜品")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"dish-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.dishes,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"dish-card"},[e.createElementVNode("view",{class:"dish-info"},[e.createElementVNode("view",{class:"dish-header"},[e.createElementVNode("text",{class:"dish-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"dish-price"},"¥"+e.toDisplayString(t.price),1)]),e.createElementVNode("text",{class:"dish-desc"},e.toDisplayString(t.description),1),e.createElementVNode("view",{class:"dish-footer"},[e.createElementVNode("text",{class:"stock-info"},"库存："+e.toDisplayString(t.stock),1),e.createElementVNode("button",{class:"edit-btn",onClick:e=>l.showEditDishModal(t)},"修改信息",8,["onClick"])])])])))),128))])),s.showAddModal?(e.openBlock(),e.createElementBlock("view",{key:3,class:"modal-mask"},[e.createElementVNode("view",{class:"popup-content"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"新增菜品"),e.createElementVNode("text",{class:"close-btn",onClick:a[1]||(a[1]=(...e)=>l.hideAddDishModal&&l.hideAddDishModal(...e))},"×")]),e.createElementVNode("view",{class:"form"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[2]||(a[2]=e=>s.newDish.name=e),placeholder:"菜品名称"},null,512),[[e.vModelText,s.newDish.name]]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[3]||(a[3]=e=>s.newDish.price=e),type:"digit",placeholder:"价格"},null,512),[[e.vModelText,s.newDish.price]]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[4]||(a[4]=e=>s.newDish.stock=e),type:"number",placeholder:"初始库存"},null,512),[[e.vModelText,s.newDish.stock]]),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[5]||(a[5]=e=>s.newDish.description=e),placeholder:"菜品描述"},null,512),[[e.vModelText,s.newDish.description]]),e.createElementVNode("button",{class:"submit-btn",onClick:a[6]||(a[6]=(...e)=>l.addDish&&l.addDish(...e))},"确认添加")])])])):e.createCommentVNode("",!0),s.showEditModal?(e.openBlock(),e.createElementBlock("view",{key:4,class:"modal-mask"},[e.createElementVNode("view",{class:"popup-content"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"修改菜品"),e.createElementVNode("text",{class:"close-btn",onClick:a[7]||(a[7]=(...e)=>l.hideEditDishModal&&l.hideEditDishModal(...e))},"×")]),e.createElementVNode("view",{class:"form"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[8]||(a[8]=e=>s.editingDish.name=e),placeholder:"菜品名称"},null,512),[[e.vModelText,s.editingDish.name]]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[9]||(a[9]=e=>s.editingDish.price=e),type:"digit",placeholder:"价格"},null,512),[[e.vModelText,s.editingDish.price]]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[10]||(a[10]=e=>s.editingDish.stock=e),type:"number",placeholder:"库存"},null,512),[[e.vModelText,s.editingDish.stock]]),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[11]||(a[11]=e=>s.editingDish.description=e),placeholder:"菜品描述"},null,512),[[e.vModelText,s.editingDish.description]]),e.createElementVNode("button",{class:"submit-btn",onClick:a[12]||(a[12]=(...e)=>l.updateDish&&l.updateDish(...e))},"确认修改")])])])):e.createCommentVNode("",!0)])}]]);const m=a({data:()=>({orders:[],baseUrl:"http://38.55.235.56:3000/api",userId:"",showComplaint:!1,complaintTypes:["配送延迟","态度恶劣","商品损坏","未按要求配送","其他"],complaintTypeIndex:0,complaintForm:{order_id:null,complainant_id:"",complaint_type:"",reason:"",evidence:""}}),onLoad(e){e.userId&&(this.userId=e.userId,this.complaintForm.complainant_id=e.userId,this.fetchOrders())},methods:{async fetchOrders(){try{const e=(await new Promise(((e,t)=>{uni.request({url:`${this.baseUrl}/order/user/${this.userId}`,method:"GET",success:t=>{e(t)},fail:e=>{t(e)}})}))).data;if(!e||!e.success)throw new Error((null==e?void 0:e.message)||"获取订单列表失败");this.orders=e.data}catch(e){t("error","at pages/user/orders/orders.vue:158","获取订单列表失败:",e),uni.showToast({title:"获取订单列表失败",icon:"none"})}},formatTime(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},async handlePay(e){try{const t=(await new Promise(((t,a)=>{uni.request({url:`${this.baseUrl}/order/pay`,method:"POST",data:{order_id:e},success:e=>{t(e)},fail:e=>{a(e)}})}))).data;if(!t||!t.success)throw new Error((null==t?void 0:t.message)||"支付失败");uni.showToast({title:"支付成功",icon:"success"}),this.fetchOrders()}catch(a){t("error","at pages/user/orders/orders.vue:201","支付失败:",a),uni.showToast({title:a.message||"支付失败",icon:"none"})}},showComplaintModal(e){this.complaintForm.order_id=e,this.showComplaint=!0},hideComplaintModal(){this.showComplaint=!1,this.resetComplaintForm()},resetComplaintForm(){this.complaintForm={order_id:null,complainant_id:this.userId,complaint_type:"",reason:"",evidence:""},this.complaintTypeIndex=0},onComplaintTypeChange(e){const t=e.detail.value;this.complaintTypeIndex=t,this.complaintForm.complaint_type=this.complaintTypes[t]},async submitComplaint(){if(this.complaintForm.complaint_type&&this.complaintForm.reason)try{const e=(await new Promise(((e,t)=>{uni.request({url:`${this.baseUrl}/order/complaint`,method:"POST",data:this.complaintForm,success:t=>{e(t)},fail:e=>{t(e)}})}))).data;if(!e||!e.success)throw new Error((null==e?void 0:e.message)||"投诉提交失败");uni.showToast({title:"投诉提交成功",icon:"success"}),this.hideComplaintModal()}catch(e){t("error","at pages/user/orders/orders.vue:271","投诉提交失败:",e),uni.showToast({title:e.message||"投诉提交失败",icon:"none"})}else uni.showToast({title:"请填写投诉类型和原因",icon:"none"})}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"orders-page"},[e.createElementVNode("view",{class:"order-list"},[0===s.orders.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",null,"暂无订单")])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(s.orders,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.orderId,class:"order-card"},[e.createElementVNode("view",{class:"order-header"},[e.createElementVNode("text",{class:"order-id"},"订单号："+e.toDisplayString(t.orderId),1),e.createElementVNode("text",{class:"order-time"},e.toDisplayString(l.formatTime(t.orderTime)),1)]),e.createElementVNode("view",{class:"order-content"},[e.createElementVNode("view",{class:"delivery-info"},[e.createElementVNode("text",{class:"label"},"配送地址："),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.buyerPosition),1)]),e.createElementVNode("view",{class:"category-info"},[e.createElementVNode("text",{class:"label"},"就餐时段："),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.category),1)]),e.createElementVNode("view",{class:"items-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"item"},[e.createElementVNode("view",{class:"item-main"},[e.createElementVNode("text",{class:"dish-name"},e.toDisplayString(t.dishName),1),e.createElementVNode("text",{class:"quantity"},"x"+e.toDisplayString(t.quantity),1)]),e.createElementVNode("view",{class:"item-sub"},[e.createElementVNode("text",{class:"price"},"¥"+e.toDisplayString(t.price),1),t.note?(e.openBlock(),e.createElementBlock("text",{key:0,class:"note"},"备注："+e.toDisplayString(t.note),1)):e.createCommentVNode("",!0)])])))),128))])]),e.createElementVNode("view",{class:"order-footer"},[e.createElementVNode("view",{class:"status-group"},[e.createElementVNode("text",{class:e.normalizeClass(["payment-status",t.paymentStatus])},e.toDisplayString(t.paymentStatus),3),t.deliveryStatus?(e.openBlock(),e.createElementBlock("text",{key:0,class:e.normalizeClass(["delivery-status",t.deliveryStatus])},e.toDisplayString(t.deliveryStatus),3)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"action-group"},[e.createElementVNode("text",{class:"total-amount"},"总计：¥"+e.toDisplayString(t.totalAmount),1),"未支付"===t.paymentStatus?(e.openBlock(),e.createElementBlock("button",{key:0,class:"pay-btn",onClick:e=>l.handlePay(t.orderId)},"立即支付",8,["onClick"])):e.createCommentVNode("",!0),"已送达"===t.deliveryStatus?(e.openBlock(),e.createElementBlock("button",{key:1,class:"complaint-btn",onClick:e=>l.showComplaintModal(t.orderId)},"投诉",8,["onClick"])):e.createCommentVNode("",!0)])])])))),128))]),s.showComplaint?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-mask"},[e.createElementVNode("view",{class:"complaint-modal"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"提交投诉"),e.createElementVNode("text",{class:"close-btn",onClick:a[0]||(a[0]=(...e)=>l.hideComplaintModal&&l.hideComplaintModal(...e))},"×")]),e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"投诉类型"),e.createElementVNode("picker",{class:"picker",value:s.complaintTypeIndex,range:s.complaintTypes,onChange:a[1]||(a[1]=(...e)=>l.onComplaintTypeChange&&l.onComplaintTypeChange(...e))},[e.createElementVNode("view",{class:"picker-value"},e.toDisplayString(s.complaintForm.complaint_type||"请选择投诉类型"),1)],40,["value","range"])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"投诉原因"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[2]||(a[2]=e=>s.complaintForm.reason=e),placeholder:"请详细描述您的投诉原因"},null,512),[[e.vModelText,s.complaintForm.reason]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"证据说明（选填）"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[3]||(a[3]=e=>s.complaintForm.evidence=e),placeholder:"请提供相关证据说明"},null,512),[[e.vModelText,s.complaintForm.evidence]])])]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"cancel-btn",onClick:a[4]||(a[4]=(...e)=>l.hideComplaintModal&&l.hideComplaintModal(...e))},"取消"),e.createElementVNode("button",{class:"submit-btn",onClick:a[5]||(a[5]=(...e)=>l.submitComplaint&&l.submitComplaint(...e))},"提交")])])])):e.createCommentVNode("",!0)])}]]);const u=a({data:()=>({complaints:[],userId:"",loading:!0,baseUrl:"http://38.55.235.56:3000/api"}),onLoad(e){if(t("log","at pages/user/complaints/complaints.vue:59","Route options:",e),e.userId)this.userId=e.userId;else{const e=uni.getStorageSync("userInfo");if(!e)return uni.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{uni.navigateBack()}),1500);this.userId=e.userId}this.loadComplaints()},onPullDownRefresh(){this.loadComplaints()},methods:{async loadComplaints(){this.loading=!0;try{t("log","at pages/user/complaints/complaints.vue:88","Loading complaints for userId:",this.userId);const e=await uni.request({url:`${this.baseUrl}/order/complaints/${this.userId}`,method:"GET"});t("log","at pages/user/complaints/complaints.vue:94","API Response:",e),e.data.success?this.complaints=e.data.data:uni.showToast({title:e.data.message||"获取投诉记录失败",icon:"none"})}catch(e){t("error","at pages/user/complaints/complaints.vue:105","获取投诉记录失败:",e),uni.showToast({title:"获取投诉记录失败",icon:"none"})}finally{this.loading=!1,uni.stopPullDownRefresh()}},formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},getStatusClass(e){switch(e){case"待处理":return"status-pending";case"处理中":return"status-processing";case"已处理":return"status-completed";default:return""}}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"complaints-container"},[e.createElementVNode("view",{class:"complaints-list"},[s.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-state"},[e.createElementVNode("text",null,"加载中...")])):0===s.complaints.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{src:"/static/images/no-data.png",mode:"aspectFit",class:"empty-image"}),e.createElementVNode("text",{class:"empty-text"},"暂无投诉记录")])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:2},e.renderList(s.complaints,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.complaintId,class:"complaint-card"},[e.createElementVNode("view",{class:"complaint-header"},[e.createElementVNode("text",{class:"order-time"},"订单时间："+e.toDisplayString(l.formatDate(t.orderTime)),1),e.createElementVNode("text",{class:e.normalizeClass(["status",l.getStatusClass(t.status)])},e.toDisplayString(t.status),3)]),e.createElementVNode("view",{class:"complaint-content"},[e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"订单类型："),e.createElementVNode("text",null,e.toDisplayString(t.category),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"配送地址："),e.createElementVNode("text",null,e.toDisplayString(t.buyerPosition),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"投诉类型："),e.createElementVNode("text",null,e.toDisplayString(t.complaintType),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"投诉原因："),e.createElementVNode("text",null,e.toDisplayString(t.reason),1)]),t.evidence?(e.openBlock(),e.createElementBlock("view",{key:0,class:"info-row"},[e.createElementVNode("text",{class:"label"},"证据说明："),e.createElementVNode("text",null,e.toDisplayString(t.evidence),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"投诉时间："),e.createElementVNode("text",null,e.toDisplayString(l.formatDate(t.createdAt)),1)])])])))),128))])])}]]);const h=a({data:()=>({userForm:{name:"",college:"",contact:"",grade:""},userId:"",baseUrl:"http://38.55.235.56:3000/api"}),onLoad(){const e=uni.getStorageSync("userInfo");if(t("log","at pages/user/settings/settings.vue:67","Current userInfo:",e),!e)return uni.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{uni.navigateBack()}),1500);this.userId=e.userId,this.userForm={name:e.name||"",college:e.college||"",contact:e.contact||"",grade:e.grade||""},t("log","at pages/user/settings/settings.vue:89","Form initialized with:",this.userForm)},methods:{validateForm(){return this.userForm.name?this.userForm.college?this.userForm.contact?!!this.userForm.grade||(uni.showToast({title:"请输入年级",icon:"none"}),!1):(uni.showToast({title:"请输入联系方式",icon:"none"}),!1):(uni.showToast({title:"请输入学院",icon:"none"}),!1):(uni.showToast({title:"请输入姓名",icon:"none"}),!1)},async handleSubmit(){if(this.validateForm())if(this.userId){t("log","at pages/user/settings/settings.vue:136","Submitting form with userId:",this.userId),t("log","at pages/user/settings/settings.vue:137","Form data:",this.userForm);try{const e=await uni.request({url:`${this.baseUrl}/user/${this.userId}`,method:"POST",data:this.userForm});if(t("log","at pages/user/settings/settings.vue:146","API Response:",e),200===e.statusCode&&e.data.success){const e={...uni.getStorageSync("userInfo"),...this.userForm};uni.setStorageSync("userInfo",e),uni.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}else uni.showToast({title:e.data.message||"保存失败",icon:"none"})}catch(e){t("error","at pages/user/settings/settings.vue:174","更新用户信息失败:",e),uni.showToast({title:"保存失败",icon:"none"})}}else uni.showToast({title:"用户ID不存在，请重新登录",icon:"none"})}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"settings-container"},[e.createElementVNode("view",{class:"settings-form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"姓名"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.userForm.name=e),placeholder:"请输入姓名"},null,512),[[e.vModelText,s.userForm.name]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"学院"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>s.userForm.college=e),placeholder:"请输入学院"},null,512),[[e.vModelText,s.userForm.college]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"联系方式"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>s.userForm.contact=e),placeholder:"请输入联系方式"},null,512),[[e.vModelText,s.userForm.contact]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"年级"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>s.userForm.grade=e),placeholder:"请输入年级"},null,512),[[e.vModelText,s.userForm.grade]])]),e.createElementVNode("button",{class:"submit-btn",onClick:a[4]||(a[4]=(...e)=>l.handleSubmit&&l.handleSubmit(...e))},"保存修改")])])}]]);const p=a({data:()=>({merchantForm:{name:"",description:"",phone:""},merchantNo:"",baseUrl:"http://38.55.235.56:3000/api"}),onLoad(){const e=uni.getStorageSync("merchantInfo");if(t("log","at pages/merchant/settings/settings.vue:55","Current merchantInfo:",e),!e)return uni.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{uni.navigateBack()}),1500);this.merchantNo=e.merchantNo,this.merchantForm={name:e.name||"",description:e.description||"",phone:e.phone||""},t("log","at pages/merchant/settings/settings.vue:76","Form initialized with:",this.merchantForm)},methods:{validateForm(){return this.merchantForm.name?!!this.merchantForm.phone||(uni.showToast({title:"请输入联系电话",icon:"none"}),!1):(uni.showToast({title:"请输入店铺名称",icon:"none"}),!1)},async handleSubmit(){if(this.validateForm())if(this.merchantNo){t("log","at pages/merchant/settings/settings.vue:109","Submitting form with merchantNo:",this.merchantNo),t("log","at pages/merchant/settings/settings.vue:110","Form data:",this.merchantForm);try{const e=await uni.request({url:`${this.baseUrl}/merchant/${this.merchantNo}`,method:"POST",data:this.merchantForm});if(t("log","at pages/merchant/settings/settings.vue:119","API Response:",e),200===e.statusCode&&e.data.success){const e={...uni.getStorageSync("merchantInfo"),...this.merchantForm};uni.setStorageSync("merchantInfo",e),uni.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}else uni.showToast({title:e.data.message||"保存失败",icon:"none"})}catch(e){t("error","at pages/merchant/settings/settings.vue:147","更新商家信息失败:",e),uni.showToast({title:"保存失败",icon:"none"})}}else uni.showToast({title:"商家编号不存在，请重新登录",icon:"none"})}}},[["render",function(t,a,n,o,s,l){return e.openBlock(),e.createElementBlock("view",{class:"settings-container"},[e.createElementVNode("view",{class:"settings-form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"店铺名称"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.merchantForm.name=e),placeholder:"请输入店铺名称"},null,512),[[e.vModelText,s.merchantForm.name]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"店铺描述"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[1]||(a[1]=e=>s.merchantForm.description=e),placeholder:"请输入店铺描述"},null,512),[[e.vModelText,s.merchantForm.description]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"联系电话"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>s.merchantForm.phone=e),placeholder:"请输入联系电话"},null,512),[[e.vModelText,s.merchantForm.phone]])]),e.createElementVNode("button",{class:"submit-btn",onClick:a[3]||(a[3]=(...e)=>l.handleSubmit&&l.handleSubmit(...e))},"保存修改")])])}]]);__definePage("pages/tabbar/index/index",n),__definePage("pages/tabbar/order/order",o),__definePage("pages/tabbar/mine/mine",s),__definePage("pages/admin/merchant-audit/merchant-audit",l),__definePage("pages/admin/complaints/complaints",i),__definePage("pages/admin/blacklist/blacklist",r),__definePage("pages/user/deliveries/deliveries",c),__definePage("pages/merchant/dishes/dishes",d),__definePage("pages/user/orders/orders",m),__definePage("pages/user/complaints/complaints",u),__definePage("pages/user/settings/settings",h),__definePage("pages/merchant/settings/settings",p);const g={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:E,Vuex:w,Pinia:N}={app:e.createVueApp(g)};uni.Vuex=w,uni.Pinia=N,E.provide("__globalStyles",__uniConfig.styles),E._component.mpType="app",E._component.render=()=>{},E.mount("#app")}(Vue);
